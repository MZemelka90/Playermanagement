<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Training Load Tracker</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Loading Screen -->
  <div class="loader-container" id="loader">
    <div class="loader"></div>
    <div class="loader-text">Training Load Tracker</div>
    <div class="loader-subtext">Ger√§t wird erkannt...</div>
  </div>

  <!-- Choice Screen (falls automatische Erkennung unsicher) -->
  <div class="choice-container" id="choice">
    <h1>‚öΩ Training Load Tracker</h1>
    <p>W√§hlen Sie die gew√ºnschte Ansicht:</p>
    <div class="button-group">
      <button class="choice-btn primary" onclick="selectVersion('tablet')">
        üì± Tablet-Version<br>
        <small style="font-size:14px; font-weight:400;">Touch-optimiert</small>
      </button>
      <button class="choice-btn" onclick="selectVersion('desktop')">
        üíª Desktop-Version<br>
        <small style="font-size:14px; font-weight:400;">Vollst√§ndige Ansicht</small>
      </button>
    </div>
    <p class="info-text">
      Ihre Wahl wird gespeichert. Sie k√∂nnen jederzeit wechseln.
    </p>
  </div>

  <script>
    // ========== GER√ÑTEERKENNUNG ==========

    function detectDevice() {
      const userAgent = navigator.userAgent.toLowerCase();
      const hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;

      // Erkennung von Tablet-Ger√§ten
      const isTablet = (
        // iPad explizit
        /ipad/.test(userAgent) ||
        // Android Tablets
        (/android/.test(userAgent) && !/mobile/.test(userAgent)) ||
        // Surface und andere Windows Tablets
        (/windows/.test(userAgent) && hasTouch && screenWidth >= 768) ||
        // Allgemeine Touch-Ger√§te mit Tablet-Gr√∂√üe
        (hasTouch && screenWidth >= 768 && screenWidth <= 1366)
      );

      // Erkennung von Smartphones
      const isMobile = (
        /mobile/.test(userAgent) ||
        (hasTouch && screenWidth < 768)
      );

      // Desktop
      const isDesktop = !isTablet && !isMobile;

      return {
        isTablet,
        isMobile,
        isDesktop,
        hasTouch,
        screenWidth,
        screenHeight,
        userAgent
      };
    }

    // ========== VERSION-AUSWAHL ==========

    function getStoredPreference() {
      try {
        return localStorage.getItem('preferred-version');
      } catch (e) {
        return null;
      }
    }

    function setStoredPreference(version) {
      try {
        localStorage.setItem('preferred-version', version);
      } catch (e) {
        console.warn('LocalStorage nicht verf√ºgbar');
      }
    }

    function selectVersion(version) {
      setStoredPreference(version);
      redirectToVersion(version);
    }

    function redirectToVersion(version) {
      const path = version === 'tablet' ? '/tablet.html' : '/desktop.html';
      window.location.href = path;
    }

    // ========== AUTOMATISCHE WEITERLEITUNG ==========

    function autoRedirect() {
      // 1. Pr√ºfe gespeicherte Pr√§ferenz
      const stored = getStoredPreference();
      if (stored) {
        console.log('Verwende gespeicherte Pr√§ferenz:', stored);
        redirectToVersion(stored);
        return;
      }

      // 2. Erkenne Ger√§t
      const device = detectDevice();
      console.log('Ger√§teerkennung:', device);

      // 3. Entscheide automatisch
      if (device.isTablet || device.isMobile) {
        console.log('Tablet/Mobile erkannt ‚Üí Tablet-Version');
        // Kleine Verz√∂gerung f√ºr bessere UX
        setTimeout(() => {
          redirectToVersion('tablet');
        }, 800);
      } else if (device.isDesktop) {
        console.log('Desktop erkannt ‚Üí Desktop-Version');
        setTimeout(() => {
          redirectToVersion('desktop');
        }, 800);
      } else {
        // 4. Falls unsicher: Zeige Auswahl
        console.log('Ger√§t unklar ‚Üí Zeige Auswahl');
        setTimeout(() => {
          document.getElementById('loader').style.display = 'none';
          document.getElementById('choice').classList.add('show');
        }, 500);
      }
    }

    // ========== URL-PARAMETER OVERRIDE ==========

    function checkURLOverride() {
      const params = new URLSearchParams(window.location.search);
      const forceVersion = params.get('version');

      if (forceVersion === 'tablet' || forceVersion === 'desktop') {
        console.log('URL-Override:', forceVersion);
        setStoredPreference(forceVersion);
        redirectToVersion(forceVersion);
        return true;
      }

      return false;
    }

    // ========== INITIALISIERUNG ==========

    // Pr√ºfe URL-Override zuerst
    if (!checkURLOverride()) {
      // Starte automatische Erkennung
      autoRedirect();
    }
  </script>
</body>
</html>
